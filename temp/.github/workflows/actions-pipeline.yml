name: Deploy to AWS

on:
 push:
    branches:
      - main
env:
  AWS_REGION : "eu-central-1"

permissions:
  id-token: write # This is required for requesting the JWT
  contents: read  # This is required for actions/checkout

jobs:
 deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/@v4

    - name: Set up AWS CLI
      uses: aws-actions/configure-aws-credentials@v4.1.1
      with:
        role-to-assume: arn:aws:iam::441574248777:role/gitlab_demo
        aws-region: ${{ env.AWS_REGION }}
        role-session-name: gitlab_demo

    - name: Deploy with AWS SAM
      run: |
        sam build
        sam deploy --guided
